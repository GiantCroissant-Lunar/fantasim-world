# Self-Critique Evaluation Rubric
# Default criteria for agent hub consumers
#
# Override per-feature by creating specs/<feature>/critique.yaml
# with `extends: default` and criterion overrides.

version: 1

# Pass when total weighted score >= threshold
threshold: 0.80

# Maximum fix attempts before escalating to human
max_iterations: 3

# Evaluation criteria with weights (must sum to 1.0)
criteria:
  spec_alignment:
    weight: 0.30
    description: "Implementation matches spec requirements and acceptance criteria"
    checks:
      - "All spec requirements addressed"
      - "Acceptance criteria met"
      - "Edge cases from spec handled"

  architecture_compliance:
    weight: 0.25
    description: "Implementation follows project architecture doctrine"
    blocker: true  # Fails entire check if violated
    checks:
      - "Layer boundaries respected"
      - "No unauthorized cross-layer dependencies"
      - "Implementation details not leaked into public APIs"
      - "Derived data does not become source-of-truth dependency"

  contract_stability:
    weight: 0.20
    description: "IDs and schemas stable, algorithms behind contracts"
    checks:
      - "IDs are readonly and immutable"
      - "Event schemas are backwards-compatible"
      - "Algorithms are behind interfaces, not exposed"
      - "No breaking changes to existing contracts"

  convention_adherence:
    weight: 0.15
    description: "Project coding conventions and patterns followed"
    checks:
      - "Naming conventions followed"
      - "Serialization patterns correct"
      - "Error handling follows project standards"
      - "No implementation details in persisted state"

  runnable:
    weight: 0.10
    description: "Code compiles and tests pass"
    blocker: true  # Fails entire check if violated
    checks:
      - "Code compiles without errors"
      - "All existing tests pass"
      - "No broken imports or dependencies"
      - "Each commit is independently runnable"

# Scoring guide for each criterion
scoring:
  1.0: "Fully meets all checks"
  0.8: "Meets most checks, minor gaps"
  0.6: "Partial compliance, notable gaps"
  0.4: "Significant violations"
  0.2: "Major violations"
  0.0: "Complete failure or blocker triggered"
